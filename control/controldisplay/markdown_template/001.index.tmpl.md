{{ if gt (len .Root.Groups) 1 }}
{{ template "groupsummary" .Root.Summary.Status }}
{{ end }}
{{ if .Root.ControlRuns }}
{{ range .Root.ControlRuns -}}
{{ template "control_run_template" . -}}
{{ end }}
{{ end }}
{{ range .Root.Groups -}}
{{ template "group_template" . -}}
{{ end }}
_Report run at `{{ .StartTime.Format "2006-01-02 15:04:05" }}` using [`Steampipe {{ steampipeversion }}`](https://steampipe.io) in dir `{{ workingdir }}`._

{{ define "group_template"}}
# {{ .Title }}
{{ template "groupsummary" .Summary.Status -}}
{{ if .ControlRuns }}
{{ range .ControlRuns -}}
{{ template "control_run_template" . -}}
{{ end -}}
{{ end -}}
{{ range .Groups -}}
{{ template "group_template" . -}}
{{ end -}}
{{ end -}}

{{ define "groupsummary" }}
| | TOTAL | {{ asstr .TotalCount }} |
|-|-|-|
| ✅ | OK | {{ .Ok }} |
| ⇨ | Skip | {{ .Skip }} |
| ℹ | Info | {{ .Info }} |
| ❌ | Alarm | {{ .Alarm }} |
| ❗ | Error | {{ .Error }} |
{{ end -}}

{{ define "summary" }}
| OK | Skip | Info | Alarm | Error | Total |
|-|-|-|-|-|-|
| {{ .Ok }} | {{ .Skip }} | {{ .Info }} | {{ .Alarm }} | {{ .Error }} | {{ asstr .TotalCount }} |
{{ end -}}

{{ define "control_row_template" }}
| {{ statusicon .Status }} | {{ if ne .Resource "<nil>" }}{{ .Resource }}{{ end }} {{ .Reason }}| {{range .Dimensions}}`{{.Value}}` {{ end }} |
{{- end }}

{{ define "control_run_template"}}
## {{ .Title }}
{{ template "summary" .Summary -}}
{{ if .Description }} *{{ .Description }}* {{ end }}
{{ if .GetError }}
> Error: _{{ .GetError }}_
{{ else }}
| | Reason | Dimensions |
|-|--------|------------|
{{- range .Rows }}
{{- template "control_row_template" . -}}
{{ end -}}
{{ end }}
{{ end }}
