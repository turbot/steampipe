{{ define "output" -}}
	{{ template "result_group" .Data.Root }}
{{ end }}

{{/* sub template for result groups */}}
{{ define "result_group" -}}
{{- $length_grp := (sub (len .Groups) 1) -}}
{{- $length_run := (sub (len .ControlRuns) 1) -}}
{
	"group_id": {{ toJson .GroupId }},
	"title": {{ toJson .Title }},
	"description": {{ toJson .Description }},
	"tags": {{ toJson .Tags }},
	{{ template "group_summary" . }}
	"groups": [
		{{- range $grpIdx,$grp := .Groups -}}
		{{- if ne $grpIdx $length_grp }}
			{{ template "result_group" . -}},
		{{- end}}
		{{- if eq $grpIdx $length_grp }}
			{{ template "result_group" . -}}
		{{- end}}
		{{- end -}}
	],
	"controls": 
	{{- if gt (len .ControlRuns) 0 -}}
	 [
		{{- range $runIdx,$run := .ControlRuns -}}
		{{- if ne $runIdx $length_run -}}
			{{- template "control_run" . -}},
		{{- end }}
		{{- if eq $runIdx $length_run -}}
			{{- template "control_run" . -}}
		{{- end }}
		{{- end -}}
	]
	{{- end -}}
	{{- if eq (len .ControlRuns) 0 -}}
	 null
	{{- end }}
}
{{ end }}



{{/* sub template for control runs */}}
{{ define "control_run" }}
{{- $length_row := (sub (len .Rows) 1) -}}
	{
		"results": [
			{{- range $rowIdx,$row := .Rows -}}
			{{- if ne $rowIdx $length_row -}}
				{{- template "control_row" . -}},
			{{- end }}
			{{- if eq $rowIdx $length_row -}}
				{{- template "control_row" . -}}
			{{- end }}
			{{- end }}
		],
		"control_id": {{ toJson .ControlId }},
		"description": {{ toJson .Description }},
		"severity": {{ toJson .Severity }},
		"tags": {{ toJson .Tags }},
		"title": {{ toJson .Title }}
	}
{{- end }}

{{/* sub template for control rows */}}
{{ define "control_row" }}
		{
			"reason": {{ toJson .Reason }},
			"resource": {{ toJson .Resource }},
			"status": {{ toJson .Status }},
			"dimensions": [
				{{ range .Dimensions -}}
					{
						"key": {{ toJson .Key }},
						"value": {{ toJson .Value }}
					}
				{{ end -}}
			]
		}
{{- end }}

{{/* sub template for group summary */}}
{{ define "group_summary" -}}
	"summary": {
		"status": {
			"alarm": {{ .Summary.Status.Alarm }},
			"ok": {{ .Summary.Status.Ok }},
			"info": {{ .Summary.Status.Info }},
			"skip": {{ .Summary.Status.Skip }},
			"error": {{ .Summary.Status.Error }}
		}
	},
{{- end }}