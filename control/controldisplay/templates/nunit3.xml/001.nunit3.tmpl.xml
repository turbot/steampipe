{{ define "outlet" }}
<test-run testcasecount="{{ .Root.Summary.Status.TotalCount }}" total="{{ .Root.Summary.Status.TotalCount }}" passed="{{ .Root.Summary.Status.PassedCount }}" failed="{{ .Root.Summary.Status.FailedCount }}" skipped="{{ .Root.Summary.Status.Skip }}">
    {{ range .Root.Groups  }}
        {{ template "group_template" . }}
    {{ end }}
    
    {{ range .Root.ControlRuns -}}
        {{ template "control_run_template" . -}}
    {{ end -}}
</test-run>
{{ end }}

{{ define "group_template" }}
<test-suite id="{{ .GroupId }}" name="{{ .Title }}" duration="{{ .Duration | DurationInFloat }}" testcasecount="{{ .Summary.Status.TotalCount }}" total="{{ .Summary.Status.TotalCount }}" passed="{{ .Summary.Status.PassedCount }}" failed="{{ .Summary.Status.FailedCount }}" skipped="{{ .Summary.Status.Skip }}">
    {{ range .Groups }}
        {{ template "group_template" . }}
    {{ end }}
    
    {{ range .ControlRuns -}}
        {{ template "control_run_template" . -}}
    {{ end -}}
</test-suite>
{{ end }}

{{ define "control_run_template" }}
<test-suite id="{{ .ControlId }}" name="{{ .Control.FullName }}" duration="{{ .Duration | DurationInFloat }}" testcasecount="{{ .Summary.TotalCount }}" total="{{ .Summary.TotalCount }}" passed="{{ .Summary.PassedCount }}" failed="{{ .Summary.FailedCount }}" skipped="{{ .Summary.Skip }}">
    {{ range $index,$row := .Rows }}
        {{ template "control_row_template" dict "idx" $index "row" $row }}
    {{ end }}
</test-suite>
{{ end }}

{{ define "control_row_template" }}
<test-case id="{{ .row.Control.ShortName }}::{{ .idx }}" name="{{ .row.Control.FullName }}::{{ .idx }}" result="{{ .row.PassedOrFailed }}">
<properties>
    <property>
     <key>steampipe:status</key>
     <value>{{ .row.Status }}</value>
    </property>
    <property>
     <key>steampipe:reason</key>
     <value>{{ .row.Reason }}</value>
    </property>
    {{ range .row.Dimensions }}
    <property>
    <key>steampipe:dimension:{{ .Key }}</key>
    <value>{{ .Value }}</value>
    </property>
    {{ end }}
</properties>
<reason>
<message><![CDATA[{{ .row.Reason }}]]></message>
</reason>
</test-case>
{{ end }}
